<template><div><h1 id="ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£" tabindex="-1"><a class="header-anchor" href="#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£"><span>ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</span></a></h1>
<p>Discord Farmbotã®ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆã¨æŠ€è¡“çš„ãªè¨­è¨ˆã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚</p>
<h2 id="ğŸ—ï¸-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦" tabindex="-1"><a class="header-anchor" href="#ğŸ—ï¸-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦"><span>ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦</span></a></h2>
<p>Discord Farmbotã¯ã€ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ãŸAIæ­è¼‰ã®ç”»åƒè§£æBotã§ã™ã€‚</p>
<div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid"><pre v-pre><code class="language-mermaid"><span class="line"><span class="token keyword">graph</span> TB</span>
<span class="line">    A<span class="token text string">[Discord User]</span> <span class="token arrow operator">--></span><span class="token label property">|/analyze command|</span> B<span class="token text string">[Discord API]</span></span>
<span class="line">    B <span class="token arrow operator">--></span> C<span class="token text string">[Cloudflare Workers]</span></span>
<span class="line">    C <span class="token arrow operator">--></span> D<span class="token text string">[Gemini Vision API]</span></span>
<span class="line">    C <span class="token arrow operator">--></span> E<span class="token text string">[Image Processing]</span></span>
<span class="line">    D <span class="token arrow operator">--></span> F<span class="token text string">[AI Analysis]</span></span>
<span class="line">    F <span class="token arrow operator">--></span> C</span>
<span class="line">    E <span class="token arrow operator">--></span> C</span>
<span class="line">    C <span class="token arrow operator">--></span><span class="token label property">|Response|</span> B</span>
<span class="line">    B <span class="token arrow operator">--></span><span class="token label property">|Thread Reply|</span> A</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”§-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯"><span>ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯</span></a></h2>
<h3 id="ã‚³ã‚¢æŠ€è¡“" tabindex="-1"><a class="header-anchor" href="#ã‚³ã‚¢æŠ€è¡“"><span>ã‚³ã‚¢æŠ€è¡“</span></a></h3>
<ul>
<li><strong>Runtime</strong>: Cloudflare Workers (V8 JavaScript Engine)</li>
<li><strong>Language</strong>: JavaScript (ES2022)</li>
<li><strong>AI API</strong>: Google Gemini Vision API</li>
<li><strong>Platform</strong>: Discord API v10</li>
</ul>
<h3 id="é–‹ç™ºãƒ»ãƒ†ã‚™ãƒ•ã‚šãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«" tabindex="-1"><a class="header-anchor" href="#é–‹ç™ºãƒ»ãƒ†ã‚™ãƒ•ã‚šãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«"><span>é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«</span></a></h3>
<ul>
<li><strong>Package Manager</strong>: npm</li>
<li><strong>Bundler</strong>: Wrangler CLI</li>
<li><strong>Version Control</strong>: Git</li>
<li><strong>CI/CD</strong>: GitHub Actions</li>
</ul>
<h3 id="ãƒˆã‚™ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ" tabindex="-1"><a class="header-anchor" href="#ãƒˆã‚™ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ"><span>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</span></a></h3>
<ul>
<li><strong>Documentation</strong>: VuePress 2.x</li>
<li><strong>Hosting</strong>: GitHub Pages</li>
</ul>
<h2 id="ğŸ“-ãƒ•ã‚šãƒ­ã‚·ã‚™ã‚§ã‚¯ãƒˆæ§‹é€ " tabindex="-1"><a class="header-anchor" href="#ğŸ“-ãƒ•ã‚šãƒ­ã‚·ã‚™ã‚§ã‚¯ãƒˆæ§‹é€ "><span>ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ </span></a></h2>
<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre v-pre><code class="language-text"><span class="line">discord-farmbot/</span>
<span class="line">â”œâ”€â”€ farmbot.js              # ãƒ¡ã‚¤ãƒ³Workerãƒ•ã‚¡ã‚¤ãƒ«</span>
<span class="line">â”œâ”€â”€ package.json            # ä¾å­˜é–¢ä¿‚ãƒ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®šç¾©</span>
<span class="line">â”œâ”€â”€ wrangler.toml           # Cloudflare Workersè¨­å®š</span>
<span class="line">â”œâ”€â”€ .dev.vars.example       # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</span>
<span class="line">â”œâ”€â”€ .gitignore             # Gité™¤å¤–è¨­å®š</span>
<span class="line">â”œâ”€â”€ LICENSE                # ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</span>
<span class="line">â”œâ”€â”€ README.md              # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦</span>
<span class="line">â”œâ”€â”€ CHANGELOG.md           # å¤‰æ›´å±¥æ­´</span>
<span class="line">â”‚</span>
<span class="line">â”œâ”€â”€ scripts/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</span>
<span class="line">â”‚   â”œâ”€â”€ deploy-secrets.sh  # ç’°å¢ƒå¤‰æ•°ãƒ‡ãƒ—ãƒ­ã‚¤</span>
<span class="line">â”‚   â””â”€â”€ register-commands.js # Discord ã‚³ãƒãƒ³ãƒ‰ç™»éŒ²</span>
<span class="line">â”‚</span>
<span class="line">â”œâ”€â”€ tests/                 # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«</span>
<span class="line">â”‚   â”œâ”€â”€ test-env.js        # ç’°å¢ƒå¤‰æ•°ãƒ†ã‚¹ãƒˆ</span>
<span class="line">â”‚   â”œâ”€â”€ test-gemini-api.js # Gemini APIãƒ†ã‚¹ãƒˆ</span>
<span class="line">â”‚   â”œâ”€â”€ test-bot.js        # Botæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</span>
<span class="line">â”‚   â””â”€â”€ test-endpoints.js  # ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ</span>
<span class="line">â”‚</span>
<span class="line">â”œâ”€â”€ docs/                  # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</span>
<span class="line">â”‚   â”œâ”€â”€ .vuepress/         # VuePressè¨­å®š</span>
<span class="line">â”‚   â”œâ”€â”€ user-guide/        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰</span>
<span class="line">â”‚   â”œâ”€â”€ developer-guide/   # é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰</span>
<span class="line">â”‚   â””â”€â”€ deployment/        # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰</span>
<span class="line">â”‚</span>
<span class="line">â””â”€â”€ .github/               # GitHubè¨­å®š</span>
<span class="line">    â””â”€â”€ workflows/         # GitHub Actions</span>
<span class="line">        â””â”€â”€ deploy-docs.yml # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”„-ãƒ†ã‚™ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼" tabindex="-1"><a class="header-anchor" href="#ğŸ”„-ãƒ†ã‚™ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼"><span>ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼</span></a></h2>
<h3 id="_1-ã‚³ãƒãƒ³ãƒˆã‚™å—ä¿¡ãƒ•ãƒ­ãƒ¼" tabindex="-1"><a class="header-anchor" href="#_1-ã‚³ãƒãƒ³ãƒˆã‚™å—ä¿¡ãƒ•ãƒ­ãƒ¼"><span>1. ã‚³ãƒãƒ³ãƒ‰å—ä¿¡ãƒ•ãƒ­ãƒ¼</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// 1. Discord ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 2. ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œè¨¼</span></span>
<span class="line">    <span class="token keyword">const</span> isValid <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">verifyDiscordRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isValid<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Unauthorized'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">401</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 3. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†</span></span>
<span class="line">    <span class="token keyword">const</span> interaction <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">handleInteraction</span><span class="token punctuation">(</span>interaction<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ç”»åƒè§£æãƒ•ãƒ­ãƒ¼" tabindex="-1"><a class="header-anchor" href="#_2-ç”»åƒè§£æãƒ•ãƒ­ãƒ¼"><span>2. ç”»åƒè§£æãƒ•ãƒ­ãƒ¼</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// 1. ç”»åƒãƒ‡ãƒ¼ã‚¿å–å¾—</span></span>
<span class="line"><span class="token keyword">const</span> imageUrl <span class="token operator">=</span> interaction<span class="token punctuation">.</span>data<span class="token punctuation">.</span>resolved<span class="token punctuation">.</span>attachments<span class="token punctuation">[</span>attachmentId<span class="token punctuation">]</span><span class="token punctuation">.</span>url<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> imageResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>imageUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> imageBuffer <span class="token operator">=</span> <span class="token keyword">await</span> imageResponse<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. ç”»åƒæ¤œè¨¼</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>imageBuffer<span class="token punctuation">.</span>byteLength <span class="token operator">></span> <span class="token constant">MAX_FILE_SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Image too large'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3. Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰</span></span>
<span class="line"><span class="token keyword">const</span> base64Image <span class="token operator">=</span> <span class="token function">arrayBufferToBase64</span><span class="token punctuation">(</span>imageBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 4. Gemini APIå‘¼ã³å‡ºã—</span></span>
<span class="line"><span class="token keyword">const</span> analysisResult <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">analyzeWithGemini</span><span class="token punctuation">(</span>base64Image<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 5. çµæœãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</span></span>
<span class="line"><span class="token keyword">const</span> formattedResult <span class="token operator">=</span> <span class="token function">formatAnalysisResult</span><span class="token punctuation">(</span>analysisResult<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 6. Discordå¿œç­”</span></span>
<span class="line"><span class="token keyword">await</span> <span class="token function">sendFollowupMessage</span><span class="token punctuation">(</span>interaction<span class="token punctuation">,</span> formattedResult<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ›ï¸-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒã‚šã‚¿ãƒ¼ãƒ³" tabindex="-1"><a class="header-anchor" href="#ğŸ›ï¸-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒã‚šã‚¿ãƒ¼ãƒ³"><span>ğŸ›ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³</span></a></h2>
<h3 id="_1-ã‚µãƒ¼ãƒã‚™ãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£" tabindex="-1"><a class="header-anchor" href="#_1-ã‚µãƒ¼ãƒã‚™ãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£"><span>1. ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</span></a></h3>
<p><strong>åˆ©ç‚¹</strong>:</p>
<ul>
<li>âœ… <strong>è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°</strong>: è² è·ã«å¿œã˜ã¦è‡ªå‹•æ‹¡å¼µ</li>
<li>âœ… <strong>ã‚³ã‚¹ãƒˆåŠ¹ç‡</strong>: ä½¿ç”¨é‡ã«å¿œã˜ãŸèª²é‡‘</li>
<li>âœ… <strong>ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸è¦</strong>: ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ãŒä¸è¦</li>
<li>âœ… <strong>é«˜å¯ç”¨æ€§</strong>: Cloudflareã®åˆ†æ•£ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</li>
</ul>
<p><strong>åˆ¶ç´„</strong>:</p>
<ul>
<li>â±ï¸ <strong>å®Ÿè¡Œæ™‚é–“åˆ¶é™</strong>: 30ç§’ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ</li>
<li>ğŸ’¾ <strong>ãƒ¡ãƒ¢ãƒªåˆ¶é™</strong>: 128MB RAM</li>
<li>ğŸ”„ <strong>ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹</strong>: æ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãªã—</li>
</ul>
<h3 id="_2-ã‚¤ãƒ˜ã‚™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£" tabindex="-1"><a class="header-anchor" href="#_2-ã‚¤ãƒ˜ã‚™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£"><span>2. ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// Discord Interaction â†’ Event Handler â†’ Response</span></span>
<span class="line"><span class="token keyword">const</span> eventHandlers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token constant">APPLICATION_COMMAND</span><span class="token operator">:</span> handleSlashCommand<span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">MESSAGE_COMPONENT</span><span class="token operator">:</span> handleButtonClick<span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">APPLICATION_COMMAND_AUTOCOMPLETE</span><span class="token operator">:</span> handleAutocomplete</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleInteraction</span><span class="token punctuation">(</span><span class="token parameter">interaction<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> handler <span class="token operator">=</span> eventHandlers<span class="token punctuation">[</span>interaction<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">handler</span><span class="token punctuation">(</span>interaction<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Unknown interaction type'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">400</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-é–¢æ•°å‹ãƒ•ã‚šãƒ­ã‚¯ã‚™ãƒ©ãƒŸãƒ³ã‚¯ã‚™" tabindex="-1"><a class="header-anchor" href="#_3-é–¢æ•°å‹ãƒ•ã‚šãƒ­ã‚¯ã‚™ãƒ©ãƒŸãƒ³ã‚¯ã‚™"><span>3. é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// ç´”ç²‹é–¢æ•°ã«ã‚ˆã‚‹ç”»åƒå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</span></span>
<span class="line"><span class="token keyword">const</span> processImage <span class="token operator">=</span> <span class="token function">pipe</span><span class="token punctuation">(</span></span>
<span class="line">  validateImageSize<span class="token punctuation">,</span></span>
<span class="line">  convertToBase64<span class="token punctuation">,</span></span>
<span class="line">  enhanceImageQuality<span class="token punctuation">,</span></span>
<span class="line">  extractMetadata</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// é–¢æ•°åˆæˆã«ã‚ˆã‚‹è§£æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</span></span>
<span class="line"><span class="token keyword">const</span> analyzeImage <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span></span>
<span class="line">  formatResult<span class="token punctuation">,</span></span>
<span class="line">  parseGeminiResponse<span class="token punctuation">,</span></span>
<span class="line">  callGeminiAPI<span class="token punctuation">,</span></span>
<span class="line">  preparePrompt</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£" tabindex="-1"><a class="header-anchor" href="#ğŸ”-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£"><span>ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</span></a></h2>
<h3 id="_1-èªè¨¼ãƒ»èªå¯" tabindex="-1"><a class="header-anchor" href="#_1-èªè¨¼ãƒ»èªå¯"><span>1. èªè¨¼ãƒ»èªå¯</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// Discord ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œè¨¼</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">verifyDiscordRequest</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> signature <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'X-Signature-Ed25519'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> timestamp <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'X-Signature-Timestamp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">verifySignature</span><span class="token punctuation">(</span></span>
<span class="line">    env<span class="token punctuation">.</span><span class="token constant">DISCORD_PUBLIC_KEY</span><span class="token punctuation">,</span></span>
<span class="line">    signature<span class="token punctuation">,</span></span>
<span class="line">    timestamp<span class="token punctuation">,</span></span>
<span class="line">    body</span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ç’°å¢ƒå¤‰æ•°ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_2-ç’°å¢ƒå¤‰æ•°ç®¡ç†"><span>2. ç’°å¢ƒå¤‰æ•°ç®¡ç†</span></a></h3>
<div class="language-toml line-numbers-mode" data-highlighter="prismjs" data-ext="toml"><pre v-pre><code class="language-toml"><span class="line"><span class="token comment"># wrangler.toml</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token table class-name">env.production</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token key property">vars</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">ENVIRONMENT</span> <span class="token punctuation">=</span> <span class="token string">"production"</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Secrets (æš—å·åŒ–ä¿å­˜)</span></span>
<span class="line"><span class="token comment"># DISCORD_PUBLIC_KEY</span></span>
<span class="line"><span class="token comment"># DISCORD_BOT_TOKEN</span></span>
<span class="line"><span class="token comment"># GEMINI_API_KEY</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-ãƒ¬ãƒ¼ãƒˆåˆ¶é™" tabindex="-1"><a class="header-anchor" href="#_3-ãƒ¬ãƒ¼ãƒˆåˆ¶é™"><span>3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// APIå‘¼ã³å‡ºã—åˆ¶é™</span></span>
<span class="line"><span class="token keyword">const</span> rateLimiter <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">gemini</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 60 requests per minute</span></span>
<span class="line">  <span class="token literal-property property">discord</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token comment">// 50 requests per second</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“Š-ãƒã‚šãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-ãƒã‚šãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ"><span>ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ</span></a></h2>
<h3 id="_1-ç”»åƒå‡¦ç†æœ€é©åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-ç”»åƒå‡¦ç†æœ€é©åŒ–"><span>1. ç”»åƒå‡¦ç†æœ€é©åŒ–</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// ç”»åƒã‚µã‚¤ã‚ºåˆ¶é™</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">MAX_FILE_SIZE</span> <span class="token operator">=</span> <span class="token number">500</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">// 500KB</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ç”»åƒå½¢å¼æ¤œè¨¼</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">SUPPORTED_FORMATS</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'image/png'</span><span class="token punctuation">,</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span> <span class="token string">'image/webp'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æœ€é©åŒ–</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">arrayBufferToBase64</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> len <span class="token operator">=</span> bytes<span class="token punctuation">.</span>byteLength<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> binary <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// ãƒãƒ£ãƒ³ã‚¯å‡¦ç†ã§å¤§å®¹é‡ç”»åƒã«å¯¾å¿œ</span></span>
<span class="line">  <span class="token keyword">const</span> chunkSize <span class="token operator">=</span> <span class="token number">8192</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i <span class="token operator">+=</span> chunkSize<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> chunk <span class="token operator">=</span> bytes<span class="token punctuation">.</span><span class="token function">subarray</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> chunkSize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    binary <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">btoa</span><span class="token punctuation">(</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-apiæœ€é©åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-apiæœ€é©åŒ–"><span>2. APIæœ€é©åŒ–</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// Gemini API ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">ANALYSIS_PROMPT</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"></span>
<span class="line">è¾²ä½œç‰©ã®ç”»åƒã‚’å°‚é–€çš„ã«è§£æã—ã¦ãã ã•ã„ã€‚</span>
<span class="line">ä»¥ä¸‹ã®å½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ï¼š</span>
<span class="line"></span>
<span class="line">ğŸŒ± ä½œç‰©: [æ¤ç‰©å]</span>
<span class="line">ğŸ“… æˆé•·æ®µéš: [æ®µéš]</span>
<span class="line">ğŸ¥ å¥åº·çŠ¶æ…‹: [çŠ¶æ…‹]</span>
<span class="line">ğŸ’¡ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: [å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹]</span>
<span class="line"></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æœ€é©åŒ–</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">GEMINI_CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">temperature</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>        <span class="token comment">// ä¸€è²«æ€§é‡è¦–</span></span>
<span class="line">  <span class="token literal-property property">maxOutputTokens</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>   <span class="token comment">// å‡ºåŠ›åˆ¶é™</span></span>
<span class="line">  <span class="token literal-property property">topP</span><span class="token operator">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>              <span class="token comment">// å“è³ªé‡è¦–</span></span>
<span class="line">  <span class="token literal-property property">topK</span><span class="token operator">:</span> <span class="token number">10</span>                <span class="token comment">// å€™è£œåˆ¶é™</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥" tabindex="-1"><a class="header-anchor" href="#_3-ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥"><span>3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// å°†æ¥å®Ÿè£…äºˆå®š: KVã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getCachedAnalysis</span><span class="token punctuation">(</span><span class="token parameter">imageHash<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> cached <span class="token operator">=</span> <span class="token keyword">await</span> env<span class="token punctuation">.</span><span class="token constant">ANALYSIS_CACHE</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>imageHash<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>cached<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cached<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">setCachedAnalysis</span><span class="token punctuation">(</span><span class="token parameter">imageHash<span class="token punctuation">,</span> result<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">await</span> env<span class="token punctuation">.</span><span class="token constant">ANALYSIS_CACHE</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span></span>
<span class="line">    imageHash<span class="token punctuation">,</span> </span>
<span class="line">    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">expirationTtl</span><span class="token operator">:</span> <span class="token number">86400</span> <span class="token punctuation">}</span> <span class="token comment">// 24æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”„-çŠ¶æ…‹ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#ğŸ”„-çŠ¶æ…‹ç®¡ç†"><span>ğŸ”„ çŠ¶æ…‹ç®¡ç†</span></a></h2>
<h3 id="_1-ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹è¨­è¨ˆ" tabindex="-1"><a class="header-anchor" href="#_1-ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹è¨­è¨ˆ"><span>1. ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹è¨­è¨ˆ</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å‡¦ç†</span></span>
<span class="line"><span class="token comment">// ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã¯ Discord Interaction Token ã§ç®¡ç†</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleSlashCommand</span><span class="token punctuation">(</span><span class="token parameter">interaction<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// åˆæœŸå¿œç­”ï¼ˆ3ç§’ä»¥å†…å¿…é ˆï¼‰</span></span>
<span class="line">  <span class="token keyword">await</span> <span class="token function">sendInitialResponse</span><span class="token punctuation">(</span>interaction<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// éåŒæœŸå‡¦ç†</span></span>
<span class="line">  <span class="token keyword">await</span> <span class="token function">processImageAnalysis</span><span class="token punctuation">(</span>interaction<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—å¿œç­”</span></span>
<span class="line">  <span class="token keyword">await</span> <span class="token function">sendFollowupMessage</span><span class="token punctuation">(</span>interaction<span class="token punctuation">,</span> result<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_2-ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ç®¡ç†"><span>2. ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ç®¡ç†</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°éšå±¤</span></span>
<span class="line"><span class="token keyword">const</span> errorHandlers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function-variable function">ValidationError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">âŒ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">ephemeral</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function-variable function">APIError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'ğŸ”§ ä¸€æ™‚çš„ãªå•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚'</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">ephemeral</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function-variable function">UnknownError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'âš ï¸ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚µãƒãƒ¼ãƒˆã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚'</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">ephemeral</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ§ª-ãƒ†ã‚¹ãƒˆæˆ¦ç•¥" tabindex="-1"><a class="header-anchor" href="#ğŸ§ª-ãƒ†ã‚¹ãƒˆæˆ¦ç•¥"><span>ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥</span></a></h2>
<h3 id="_1-ãƒ†ã‚¹ãƒˆéšå±¤" tabindex="-1"><a class="header-anchor" href="#_1-ãƒ†ã‚¹ãƒˆéšå±¤"><span>1. ãƒ†ã‚¹ãƒˆéšå±¤</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// å˜ä½“ãƒ†ã‚¹ãƒˆ</span></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Image Processing'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'validates image size'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">validateImageSize</span><span class="token punctuation">(</span>largeImage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token string">'Image too large'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// çµ±åˆãƒ†ã‚¹ãƒˆ</span></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Gemini API Integration'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'analyzes crop image'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">analyzeWithGemini</span><span class="token punctuation">(</span>testImage<span class="token punctuation">,</span> mockEnv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'ãƒˆãƒãƒˆ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// E2Eãƒ†ã‚¹ãƒˆ</span></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Discord Bot E2E'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'handles analyze command'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">handleInteraction</span><span class="token punctuation">(</span>mockInteraction<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ãƒ¢ãƒƒã‚¯æˆ¦ç•¥" tabindex="-1"><a class="header-anchor" href="#_2-ãƒ¢ãƒƒã‚¯æˆ¦ç•¥"><span>2. ãƒ¢ãƒƒã‚¯æˆ¦ç•¥</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// API ãƒ¢ãƒƒã‚¯</span></span>
<span class="line"><span class="token keyword">const</span> mockGeminiAPI <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">analyze</span><span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">crop</span><span class="token operator">:</span> <span class="token string">'ãƒˆãƒãƒˆ'</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">stage</span><span class="token operator">:</span> <span class="token string">'é–‹èŠ±æœŸ'</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">health</span><span class="token operator">:</span> <span class="token string">'è‰¯å¥½'</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ç’°å¢ƒå¤‰æ•°ãƒ¢ãƒƒã‚¯</span></span>
<span class="line"><span class="token keyword">const</span> mockEnv <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token constant">DISCORD_PUBLIC_KEY</span><span class="token operator">:</span> <span class="token string">'test-key'</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">DISCORD_BOT_TOKEN</span><span class="token operator">:</span> <span class="token string">'test-token'</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">GEMINI_API_KEY</span><span class="token operator">:</span> <span class="token string">'test-api-key'</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“ˆ-ç›£è¦–ãƒ»ãƒ­ã‚¯ã‚™" tabindex="-1"><a class="header-anchor" href="#ğŸ“ˆ-ç›£è¦–ãƒ»ãƒ­ã‚¯ã‚™"><span>ğŸ“ˆ ç›£è¦–ãƒ»ãƒ­ã‚°</span></a></h2>
<h3 id="_1-ãƒ­ã‚¯ã‚™æˆ¦ç•¥" tabindex="-1"><a class="header-anchor" href="#_1-ãƒ­ã‚¯ã‚™æˆ¦ç•¥"><span>1. ãƒ­ã‚°æˆ¦ç•¥</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// æ§‹é€ åŒ–ãƒ­ã‚°</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">logAnalysis</span><span class="token punctuation">(</span><span class="token parameter">interaction<span class="token punctuation">,</span> result<span class="token punctuation">,</span> duration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'image_analysis'</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">user_id</span><span class="token operator">:</span> interaction<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">guild_id</span><span class="token operator">:</span> interaction<span class="token punctuation">.</span>guild_id<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">crop_detected</span><span class="token operator">:</span> result<span class="token punctuation">.</span>crop<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">confidence</span><span class="token operator">:</span> result<span class="token punctuation">.</span>confidence<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">duration_ms</span><span class="token operator">:</span> duration<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">image_size</span><span class="token operator">:</span> result<span class="token punctuation">.</span>imageSize</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ãƒ¡ãƒˆãƒªã‚¯ã‚¹" tabindex="-1"><a class="header-anchor" href="#_2-ãƒ¡ãƒˆãƒªã‚¯ã‚¹"><span>2. ãƒ¡ãƒˆãƒªã‚¯ã‚¹</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹</span></span>
<span class="line"><span class="token keyword">const</span> metrics <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">analysisCount</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">averageResponseTime</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">errorRate</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">apiUsage</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">gemini</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">discord</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸš€-ã‚¹ã‚±ãƒ¼ãƒ©ãƒ’ã‚™ãƒªãƒ†ã‚£" tabindex="-1"><a class="header-anchor" href="#ğŸš€-ã‚¹ã‚±ãƒ¼ãƒ©ãƒ’ã‚™ãƒªãƒ†ã‚£"><span>ğŸš€ ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</span></a></h2>
<h3 id="_1-æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚¯ã‚™" tabindex="-1"><a class="header-anchor" href="#_1-æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚¯ã‚™"><span>1. æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°</span></a></h3>
<ul>
<li><strong>Cloudflare Workers</strong>: è‡ªå‹•çš„ã«ä¸–ç•Œä¸­ã®ã‚¨ãƒƒã‚¸ã§å®Ÿè¡Œ</li>
<li><strong>è² è·åˆ†æ•£</strong>: Cloudflareã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</li>
<li><strong>åœ°ç†çš„åˆ†æ•£</strong>: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æœ€ã‚‚è¿‘ã„ã‚¨ãƒƒã‚¸ã§å‡¦ç†</li>
</ul>
<h3 id="_2-å‚ç›´ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚¯ã‚™" tabindex="-1"><a class="header-anchor" href="#_2-å‚ç›´ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚¯ã‚™"><span>2. å‚ç›´ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡æœ€é©åŒ–</span></span>
<span class="line"><span class="token keyword">const</span> optimizations <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">imageProcessing</span><span class="token operator">:</span> <span class="token string">'WebAssemblyå®Ÿè£…æ¤œè¨'</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">memoryUsage</span><span class="token operator">:</span> <span class="token string">'ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†'</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">cpuUsage</span><span class="token operator">:</span> <span class="token string">'Worker Threadsæ´»ç”¨'</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”®-å°†æ¥ã®æ‹¡å¼µè¨ˆç”»" tabindex="-1"><a class="header-anchor" href="#ğŸ”®-å°†æ¥ã®æ‹¡å¼µè¨ˆç”»"><span>ğŸ”® å°†æ¥ã®æ‹¡å¼µè¨ˆç”»</span></a></h2>
<h3 id="_1-æ©Ÿèƒ½æ‹¡å¼µ" tabindex="-1"><a class="header-anchor" href="#_1-æ©Ÿèƒ½æ‹¡å¼µ"><span>1. æ©Ÿèƒ½æ‹¡å¼µ</span></a></h3>
<ul>
<li><strong>ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«è§£æ</strong>: éŸ³å£°ãƒ»å‹•ç”»å¯¾å¿œ</li>
<li><strong>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–</strong>: Cron Triggersã«ã‚ˆã‚‹å®šæœŸè§£æ</li>
<li><strong>ãƒ‡ãƒ¼ã‚¿è“„ç©</strong>: Durable Objectsã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†</li>
</ul>
<h3 id="_2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é€²åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é€²åŒ–"><span>2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é€²åŒ–</span></a></h3>
<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre v-pre><code class="language-javascript"><span class="line"><span class="token comment">// ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åŒ–</span></span>
<span class="line"><span class="token keyword">const</span> services <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">imageAnalysis</span><span class="token operator">:</span> <span class="token string">'Cloudflare Workers'</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">dataStorage</span><span class="token operator">:</span> <span class="token string">'Cloudflare D1'</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">fileStorage</span><span class="token operator">:</span> <span class="token string">'Cloudflare R2'</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token string">'Cloudflare KV'</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">queue</span><span class="token operator">:</span> <span class="token string">'Cloudflare Queues'</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>
<div class="hint-container tip">
<p class="hint-container-title">ğŸ’¡ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´</p>
<p>Discord Farmbotã¯ã€<strong>ã‚·ãƒ³ãƒ—ãƒ«ã•</strong>ã¨<strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong>ã‚’ä¸¡ç«‹ã•ã›ãŸãƒ¢ãƒ€ãƒ³ãªã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã§ã‚ã‚ŠãªãŒã‚‰ã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®å¯ç”¨æ€§ã¨æ€§èƒ½ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚</p>
</div>
<div class="hint-container warning">
<p class="hint-container-title">âš ï¸ åˆ¶ç´„äº‹é …</p>
<p>Cloudflare Workersã®åˆ¶ç´„ï¼ˆå®Ÿè¡Œæ™‚é–“30ç§’ã€ãƒ¡ãƒ¢ãƒª128MBï¼‰ã‚’è€ƒæ…®ã—ãŸè¨­è¨ˆã¨ãªã£ã¦ã„ã¾ã™ã€‚å¤§å®¹é‡ç”»åƒã‚„è¤‡é›‘ãªå‡¦ç†ã«ã¯åˆ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå¿…è¦ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
</div>
</div></template>


