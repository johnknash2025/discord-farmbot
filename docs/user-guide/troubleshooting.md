# トラブルシューティング

Discord Farmbotの使用中に発生する可能性のある問題と解決方法をまとめました。

## 🚨 よくある問題と解決方法

### 1. コマンド関連の問題

#### `/analyze` コマンドが表示されない
**症状**: Discordでスラッシュコマンドが表示されない

**原因と解決方法**:
- **Bot権限不足**: サーバー管理者にBot権限の確認を依頼
- **コマンド未登録**: 開発者がコマンド登録を実行する必要がある
- **Discord側の同期遅延**: 数分待ってから再試行

```bash
# 開発者向け: コマンド再登録
node scripts/register-commands.js
```

#### コマンド実行後に反応がない
**症状**: コマンドを実行しても何も起こらない

**解決手順**:
1. **ネットワーク接続を確認**
2. **Botのオンライン状態を確認**
3. **数秒待ってから再実行**
4. **他のチャンネルで試行**

### 2. 画像関連の問題

#### 「画像が大きすぎます」エラー
**症状**: `Image too large` エラーメッセージが表示される

**解決方法**:
```bash
# 画像サイズを確認
# 制限: 500KB以下
```

**画像圧縮方法**:
- **オンライン圧縮ツール**: TinyPNG、Compressor.io
- **スマートフォン**: 画質設定を「中」に変更
- **PC**: ペイントやPhotoshopで解像度を下げる

#### 「画像ファイルを添付してください」エラー
**症状**: 画像を添付したのにエラーが出る

**確認事項**:
- **対応形式**: PNG、JPEG、WEBP のみ
- **ファイル破損**: 別の画像で試行
- **添付方法**: ドラッグ&ドロップまたはクリップアイコンから添付

#### 「解析に失敗しました」エラー
**症状**: 画像は正常だが解析が失敗する

**対処法**:
1. **画像の明るさを確認** - 暗すぎる場合は明るい場所で撮影
2. **ピントを確認** - ぼやけている場合は再撮影
3. **作物が写っているか確認** - 植物以外の画像は解析できません
4. **時間をおいて再試行** - API制限の可能性

### 3. 解析結果の問題

#### 解析結果が不正確
**症状**: 明らかに間違った作物として認識される

**改善方法**:
- **複数角度から撮影**: 葉、茎、果実など様々な部分
- **背景をシンプルに**: 土や他の植物が写らないように
- **自然光で撮影**: 室内照明より屋外の自然光が最適
- **適切な距離**: 近すぎず遠すぎない距離から撮影

#### 解析結果が表示されない
**症状**: 「解析中...」のまま結果が出ない

**確認手順**:
1. **スレッドを確認** - 結果はスレッドに投稿されます
2. **権限を確認** - Botにスレッド作成権限があるか
3. **再実行** - 一度だけ再試行してください

### 4. 権限関連の問題

#### Botがメッセージを送信できない
**症状**: Botの応答が一切ない

**必要な権限**:
- ✅ メッセージの送信
- ✅ スラッシュコマンドの使用
- ✅ メッセージ履歴の表示
- ✅ スレッドの作成
- ✅ パブリックスレッドでのメッセージ送信

**権限確認方法**:
1. サーバー設定 → 役職
2. Discord Farmbot の役職を選択
3. 上記権限が有効になっているか確認

#### 特定のチャンネルで動作しない
**症状**: 一部のチャンネルでのみ動作しない

**確認事項**:
- **チャンネル権限**: そのチャンネルでBotが発言できるか
- **カテゴリ権限**: 親カテゴリの権限設定
- **役職の順序**: Botの役職が適切な位置にあるか

### 5. パフォーマンス関連

#### 応答が遅い
**症状**: 解析に通常より長い時間がかかる

**原因**:
- **API制限**: Gemini APIの使用量制限
- **画像サイズ**: 大きな画像は処理に時間がかかる
- **サーバー負荷**: 同時利用者が多い場合

**対処法**:
- 画像サイズを小さくする（200KB以下推奨）
- 時間をおいて再試行
- 混雑時間を避ける

#### タイムアウトエラー
**症状**: 「Request timeout」エラー

**解決方法**:
```bash
# 開発者向け: タイムアウト設定確認
# Cloudflare Workers: 30秒制限
# Gemini API: 60秒制限
```

## 🔧 詳細診断

### ログの確認方法

#### ユーザー向け
1. **エラーメッセージをスクリーンショット**
2. **実行時刻を記録**
3. **使用した画像を保存**
4. **サポートに報告**

#### 開発者向け
```bash
# Cloudflare Workers ログ
wrangler tail

# 特定時間のログ
wrangler tail --since 2024-01-01T10:00:00Z

# エラーのみフィルタ
wrangler tail | grep ERROR
```

### デバッグ情報の収集

#### 環境情報
- **OS**: Windows/macOS/Linux
- **ブラウザ**: Chrome/Firefox/Safari
- **Discord**: デスクトップ/モバイル/ブラウザ版
- **画像**: サイズ、形式、撮影環境

#### 再現手順
1. 具体的な操作手順
2. 期待される結果
3. 実際の結果
4. エラーメッセージ（あれば）

## 🆘 サポートへの連絡

### 連絡前の準備
- [ ] このトラブルシューティングガイドを確認済み
- [ ] 基本的な解決方法を試行済み
- [ ] エラーメッセージのスクリーンショット準備済み
- [ ] 問題の再現手順を整理済み

### サポート窓口

#### 1. コミュニティサポート（推奨）
**Discord サーバー**: [https://discord.gg/Gq9jPaMX8g](https://discord.gg/Gq9jPaMX8g)
- 📝 `#サポート` チャンネル
- ⚡ リアルタイム対応
- 🤝 コミュニティメンバーからのサポート

#### 2. GitHub Issues
**URL**: [GitHub Issues](https://github.com/johnknash2025/discord-farmbot/issues)
- 🐛 バグ報告
- 💡 機能要望
- 📖 ドキュメント改善提案

#### 3. メールサポート
**メール**: support@farmbot.example.com
- 📧 詳細な技術的問題
- 🔒 プライベートな問題

### 報告テンプレート

```markdown
## 問題の概要
簡潔に問題を説明してください

## 環境情報
- OS: 
- Discord: デスクトップ/モバイル/ブラウザ
- 画像サイズ: 
- 画像形式: 

## 再現手順
1. 
2. 
3. 

## 期待される結果


## 実際の結果


## エラーメッセージ
```

## 📊 既知の問題

### 現在対応中
- [ ] **大容量画像の処理改善** - 500KB制限の緩和検討中
- [ ] **レスポンス時間の改善** - キャッシュ機能の実装予定
- [ ] **多言語対応** - 英語・中国語サポート開発中

### 制限事項
- **画像サイズ**: 500KB以下
- **対応形式**: PNG、JPEG、WEBP のみ
- **同時処理**: 1ユーザーあたり同時1リクエスト
- **API制限**: 1日あたりの解析回数に制限あり

## 🔄 定期メンテナンス

### メンテナンス時間
- **定期メンテナンス**: 毎週日曜日 2:00-4:00 JST
- **緊急メンテナンス**: 事前通知なしで実施される場合があります

### メンテナンス情報の確認
- **Discord サーバー**: `#お知らせ` チャンネル
- **GitHub**: [Releases](https://github.com/johnknash2025/discord-farmbot/releases)
- **ステータスページ**: https://status.farmbot.example.com

---

::: tip 💡 問題解決のコツ
1. **まずは基本的な解決方法を試す**
2. **エラーメッセージを正確に記録する**
3. **問題を再現できる最小限の手順を特定する**
4. **コミュニティで同様の問題がないか検索する**
:::

::: warning ⚠️ 注意
問題が解決しない場合は、無理に何度も試行せず、サポートにご連絡ください。API制限に達する可能性があります。
:::